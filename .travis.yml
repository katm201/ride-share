language: node_js
node_js:
- 8.4.0
sudo: required
services:
- docker
sudo: true
before_script:
- npm run build
- sudo apt-get update
- sudo apt-get autoremove postgis*
- sudo apt-get autoremove postgresql*
- sudo apt-get install postgresql-9.3-postgis-2.1
- psql -c 'create database inventory;' -U postgres
- psql -U postgres -c 'CREATE EXTENSION postgis;' -d inventory
- npm run build:db
script: node ./service/build/server/index.js & npm run test
deploy:
  provider: script
  script: docker login -u $DOCKER_LOGIN -p $DOCKER_PW && docker-compose build && docker push katm201/rideshare:latest
  on:
    branch: master
